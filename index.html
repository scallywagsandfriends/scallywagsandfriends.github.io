<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Humor Elo</title>
  <style>
    body { 
      font-family: Arial, sans-serif; 
      background: #f8f8f8; 
      padding: 20px; 
      color: #000;
      transition: background 0.3s, color 0.3s;
    }
    .person { 
      background: white; 
      padding: 10px; 
      margin: 10px 0; 
      border-radius: 8px; 
      display: flex; 
      align-items: center; 
      transition: background 0.3s, color 0.3s;
    }
    .name { flex: 1; font-weight: bold; padding-left: 10px; }
    button { margin: 0 5px; padding: 5px 10px; cursor: pointer; min-width: 30px; }
    .rating { width: 30px; text-align: center; }

    /* Dark mode styles */
    body.dark {
      background: #121212;
      color: #fff;
    }
    body.dark .person {
      background: #1e1e1e;
      color: #fff;
    }
  </style>
</head>
<body>
  <h1>Humor Elo</h1>
  <button id="darkModeToggle">Dark Mode</button>
  <div id="people"></div>

  <!-- Firebase compat SDKs -->
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyAct6mJxsbt9FUi8JXlNvi-nBu2AG7Z_J4",
      authDomain: "humorelo.firebaseapp.com",
      databaseURL: "https://humorelo-default-rtdb.firebaseio.com",
      projectId: "humorelo",
      storageBucket: "humorelo.firebasestorage.app",
      messagingSenderId: "765285537342",
      appId: "1:765285537342:web:d80667d9800c457ae3a36f",
      measurementId: "G-Y5E2Z159ZX"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const peopleList = [
      "Wazu", "Clover", "Coolingcake", "Panda", "Kelly", 
      "Kuromii", "Nuck", "Fland", "Bones", "Nobody", "Shoomie"
    ];

    const container = document.getElementById("people");
    let ratingsData = {};

    // Dark mode toggle
    const darkModeToggle = document.getElementById("darkModeToggle");
    if (localStorage.getItem("darkMode") === "true") {
      document.body.classList.add("dark");
    }
    darkModeToggle.addEventListener("click", () => {
      document.body.classList.toggle("dark");
      localStorage.setItem("darkMode", document.body.classList.contains("dark"));
    });

    // Listen for ratings
    db.ref("ratings").on("value", snapshot => {
      ratingsData = snapshot.val() || {};
      renderList();
    });

    function renderList() {
      container.innerHTML = "";
      const sortedPeople = [...peopleList].sort((a, b) => {
        const ratingA = ratingsData[a] || 0;
        const ratingB = ratingsData[b] || 0;
        if (ratingB !== ratingA) return ratingB - ratingA;
        return a.localeCompare(b);
      });

      sortedPeople.forEach(name => {
        const div = document.createElement("div");
        div.className = "person";
        div.innerHTML = `
          <button onclick="changeRating('${name}', -1)">-</button>
          <span class="rating" id="${name}-rating">${ratingsData[name] || 0}</span>
          <button onclick="changeRating('${name}', 1)">+</button>
          <span class="name">${name}</span>
        `;
        container.appendChild(div);
      });
    }

    function changeRating(name, delta) {
      const ref = db.ref("ratings/" + name);
      ref.transaction(current => (current || 0) + delta);
    }
  </script>
</body>
</html>
