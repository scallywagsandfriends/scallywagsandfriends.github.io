<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Rating System</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f8f8f8; padding: 20px; }
    .person { background: white; padding: 10px; margin: 10px 0; border-radius: 8px; display: flex; align-items: center; }
    .name { flex: 1; font-weight: bold; }
    button { margin: 0 5px; padding: 5px 10px; cursor: pointer; }
  </style>
</head>
<body>
  <h1>People Ratings</h1>
  <div id="people"></div>

  <!-- Firebase compat SDKs -->
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyAct6mJxsbt9FUi8JXlNvi-nBu2AG7Z_J4",
      authDomain: "humorelo.firebaseapp.com",
      databaseURL: "https://humorelo-default-rtdb.firebaseio.com",
      projectId: "humorelo",
      storageBucket: "humorelo.firebasestorage.app",
      messagingSenderId: "765285537342",
      appId: "1:765285537342:web:d80667d9800c457ae3a36f",
      measurementId: "G-Y5E2Z159ZX"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const peopleList = [
      "Wazu", "Clover", "Coolingcake", "Panda", "Kelly", 
      "Kuromii", "Nuck", "Fland", "Bones", "Nobody", "Shoomie"
    ];

    const container = document.getElementById("people");
    let ratingsData = {};

    // Listen for all ratings at once
    db.ref("ratings").on("value", snapshot => {
      ratingsData = snapshot.val() || {};
      renderList();
    });

    function renderList() {
      // Clear the container
      container.innerHTML = "";

      // Sort by rating (desc), then by name
      const sortedPeople = [...peopleList].sort((a, b) => {
        const ratingA = ratingsData[a] || 0;
        const ratingB = ratingsData[b] || 0;
        if (ratingB !== ratingA) {
          return ratingB - ratingA;
        }
        return a.localeCompare(b);
      });

      // Render sorted list
      sortedPeople.forEach(name => {
        const div = document.createElement("div");
        div.className = "person";
        div.innerHTML = `
          <span class="name">${name}</span>
          <button onclick="changeRating('${name}', -1)">-</button>
          <span id="${name}-rating">${ratingsData[name] || 0}</span>
          <button onclick="changeRating('${name}', 1)">+</button>
        `;
        container.appendChild(div);
      });
    }

    function changeRating(name, delta) {
      const ref = db.ref("ratings/" + name);
      ref.transaction(current => (current || 0) + delta);
    }
  </script>
</body>
</html>
